apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: a2a-route
  namespace: kgateway-system
  labels:
    app: agentgateway
spec:
  parentRefs:
    - name: agentgateway
      sectionName: http
  rules:
    # Route for Agent A (Orchestrator)
    - matches:
        - path:
            type: PathPrefix
            value: /a2a/customer-a/a2a-orchestrator-agent
      filters:
        - type: URLRewrite
          urlRewrite:
            path:
              type: ReplacePrefixMatch
              replacePrefixMatch: /api/a2a/customer-a/a2a-orchestrator-agent/
      backendRefs:
        - name: kagent-a2a-backend
          namespace: kgateway-system
          group: gateway.kgateway.dev
          kind: Backend
          port: 8083
    # Route for Agent B (Specialist)
    - matches:
        - path:
            type: PathPrefix
            value: /a2a/customer-b/a2a-specialist-agent
      filters:
        - type: URLRewrite
          urlRewrite:
            path:
              type: ReplacePrefixMatch
              replacePrefixMatch: /api/a2a/customer-b/a2a-specialist-agent/
      backendRefs:
        - name: kagent-a2a-backend
          namespace: kgateway-system
          group: gateway.kgateway.dev
          kind: Backend
          port: 8083
